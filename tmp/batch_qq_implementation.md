# batch_qq.py 実装詳細

## 概要
複数銘柄の四半期財務データを一括処理し、最新データをまとめてCSV出力するバッチ処理ツール

## 主要機能

### 1. 証券コード読み込み (`load_code_list`)
- `codelist.csv`から証券コードと銘柄名を読み込み（UTF-8-sig対応）
- ヘッダー付きCSV形式に対応（コード、銘柄名）
- 空値やNaN値の除外処理
- エラーハンドリング

### 2. 単一銘柄処理 (`process_single_stock`)
- qq.pyの関数を使用して各銘柄を処理
- 最新データのみ抽出
- 必要な項目のみ選択
- パーセント項目の100分の1変換（小数形式への変換）
- 週足株価データ取得と相関計算の統合

### 3. バッチサマリー作成 (`create_batch_summary`)
- 処理結果をデータフレームに変換
- 数値列の型変換
- CSV出力とプレビュー表示

## 出力項目
- コード
- 銘柄名（codelist.csvから取得、空欄の場合は空白）
- 株価日付（発表日+1日の週足株価データ）
- 始値（発表日+1日の週足始値）
- 発表日
- 決算期
- 四半期
- 売上高
- 経常益
- 資本合計(純資産)
- 売上高成長率（小数形式：例 5.23% → 0.0523）
- 四半期成長率（小数形式：例 5.23% → 0.0523）
- 経常益利回り（小数形式：例 5.23% → 0.0523）
- 四半期割安率_四半期平均（小数形式：例 5.23% → 0.0523）
- 四半期割安率_前年同期ベース（小数形式：例 5.23% → 0.0523）
- 四半期割安率_前四半期（小数形式：例 5.23% → 0.0523）
- 四半期成長率株価相関（最新3四半期の相関係数）
- 経常益利回り株価相関（最新3四半期の相関係数）

## エラー処理
- ページ取得失敗
- 四半期データ取得失敗
- 処理中の例外
- サーバー負荷軽減のための待機時間

## 技術的特徴
- qq.pyの既存機能を再利用
- 各銘柄間で3秒待機してサーバー負荷を軽減
- UTF-8-sig エンコーディングでCSV入出力
- データフレームによる効率的なデータ処理
- パーセント値の自動変換（%表記から小数形式へ）
- 銘柄名の動的取得と出力対応
- 週足株価データ統合（複数ページ、両テーブル対応）
- 相関計算（最新3四半期データでnumpy.corrcoef使用）
- 列順序最適化（株価データを銘柄名と発表日の間に配置）